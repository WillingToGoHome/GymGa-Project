<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.willingtogohome.gymga.sale.model.dao.SaleMapper">

    <resultMap id="salesMap" type="com.willingtogohome.gymga.sale.model.dto.SaleDTO">
        <id property="passCode" column="pass_code"/>
        <result property="salesMethod" column="sales_method"/>
        <result property="salesDate" column="sales_date"/>
    </resultMap>

<resultMap id="passResultMap" type="com.willingtogohome.gymga.pass.model.dto.PassAndPassQualDTO">
    <id property="passCode" column="pass_code"/>
    <result property="passStatus" column="pass_status"/>
    <result property="passStart" column="pass_start"/>
    <result property="passEnd" column="pass_end"/>
    <result property="passTotal" column="pass_total"/>
    <result property="passUse" column="pass_use"/>
    <result property="userCode" column="user_code"/>
    <result property="pqCode" column="pq_code"/>
    <association property="passQualDTO" javaType="com.willingtogohome.gymga.pass.model.dto.PassQualDTO">
        <id property="pqCode" column="pq_code"/>
        <result property="pqName" column="pq_name"/>
        <result property="pqPrice" column="pq_price"/>
    </association>
</resultMap>

    <resultMap id="passDataResultMap" type="com.willingtogohome.gymga.pass.model.dto.PassData">
        <id property="ptCount" column="PT_Count"/>
        <result property="gxCount" column="GX_Count"/>
        <result property="gpCount" column="GP_Count"/>
    </resultMap>

    <select id="findAllList" resultMap="salesMap">
        SELECT
                pass_code,
                sales_method,
                sales_date
            FROM salesdb
    </select>

    <select id="findPassAndPassQualList" resultMap="passResultMap">
        SELECT
                A.pass_code,
                A.pq_code,
                B.pq_name,
                A.pass_status,
                A.pass_start,
                A.pass_end,
                A.pass_total,
                A.pass_use,
                A.user_code,
                B.pq_price
            FROM passdb A
            JOIN passqualdb B ON A.pq_code = B.pq_code
        order by A.pass_code;
    </select>

    <select id="sumPassData" resultMap="passDataResultMap">
        SELECT
        SUM(PT_Count) AS PT_Count,
        SUM(GX_Count) AS GX_Count,
        SUM(GP_Count) AS GP_Count
        FROM passdata
    </select>

</mapper>