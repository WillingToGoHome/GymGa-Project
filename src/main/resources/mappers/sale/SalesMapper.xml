<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.willingtogohome.gymga.sale.model.dao.SaleMapper">

    <resultMap id="salesMap" type="com.willingtogohome.gymga.sale.model.dto.SaleDTO">
        <id property="userCode" column="user_code"/>
        <result property="salesMethod" column="sales_method"/>
        <result property="salesDate" column="sales_date"/>
    </resultMap>

<resultMap id="passResultMap" type="com.willingtogohome.gymga.pass.model.dto.PassAndPassQualDTO">
    <id property="passCode" column="pass_code"/>
    <result property="pqCode" column="pq_code"/>
    <result property="passStatus" column="pass_status"/>
    <result property="passStart" column="pass_start"/>
    <result property="passEnd" column="pass_end"/>
    <result property="passTotal" column="pass_total"/>
    <result property="passUse" column="pass_use"/>
    <result property="userCode" column="user_code"/>
    <association property="passQualDTO" javaType="com.willingtogohome.gymga.pass.model.dto.PassQualDTO">
        <id property="pqCode" column="pq_code"/>
        <result property="pqName" column="pq_name"/>
        <result property="pqPrice" column="pq_price"/>
    </association>
    <association property="userDTO" javaType="com.willingtogohome.gymga.user.model.dto.UserDTO">
        <id property="userCode" column="user_code"/>
        <result property="userId" column="user_id"/>
        <result property="userPwd" column="user_pwd"/>
        <result property="userName" column="user_name"/>
        <result property="userPhone" column="user_phone"/>
        <result property="userRole" column="user_role"/>
        <result property="userPic" column="user_pic"/>
        <result property="userGender" column="user_gender"/>
        <result property="userBirth" column="user_birth"/>
        <result property="userAddress" column="user_address"/>
        <result property="userEtc" column="user_etc"/>
        <result property="userStaff" column="user_staff"/>
    </association>
    <association property="validateDTO" javaType="com.willingtogohome.gymga.sale.model.dto.ValidateDTO">
        <id property="valStatus" column="val_status"/>
        <result property="passCode" column="pass_code"/>
        <result property="userCode" column="user_code"/>
    </association>
    <association property="saleDTO" javaType="com.willingtogohome.gymga.sale.model.dto.SaleDTO">
        <id property="userCode" column="user_code"/>
        <result property="salesMethod" column="sales_method"/>
        <result property="salesDate" column="sales_date"/>
    </association>
</resultMap>

    <resultMap id="passDataResultMap" type="com.willingtogohome.gymga.pass.model.dto.PassData">
        <id property="ptCount" column="PT_Count"/>
        <result property="gxCount" column="GX_Count"/>
        <result property="gpCount" column="GP_Count"/>
    </resultMap>

    <select id="findAllList" resultMap="salesMap">
        SELECT
                user_code,
                sales_method,
                sales_date
            FROM salesdb
    </select>

    <select id="findPassAndPassQualList" resultMap="passResultMap">
        SELECT
        A.pass_code,
        A.pq_code,
        B.pq_name,
        A.pass_status,
        A.pass_start,
        A.pass_end,
        A.pass_total,
        A.pass_use,
        A.user_code,
        B.pq_price,
        D.user_name,
        E.sales_method,
        E.sales_date
        FROM passdb A
        left JOIN passqualdb B ON A.pq_code = B.pq_code
        left join validatedb C on A.pass_code = C.pass_code
        left join userdb D on C.user_code = D.user_code
        left join salesdb E on D.user_code = E.user_code
        order by A.pass_code;
    </select>

    <select id="sumPassData" resultMap="passDataResultMap">
        SELECT
            PT_Count,
            GX_Count,
            GP_Count
        FROM passdata
    </select>

<!--    <update id="updatePassData" parameterMap="passDataResultMap">-->
<!--        UPDATE passdata-->
<!--        SET (PT_Count,-->
<!--        GX_Count,-->
<!--        GP_Count)-->
<!--        SELECT-->
<!--        SUM(CASE WHEN pq_code LIKE 'PT%' THEN 1 ELSE 0 END),-->
<!--        SUM(CASE WHEN pq_code LIKE 'GX%' THEN 1 ELSE 0 END),-->
<!--        SUM(CASE WHEN pq_code LIKE 'GP%' THEN 1 ELSE 0 END)-->
<!--        FROM passdb;-->
<!--    </update>-->

</mapper>