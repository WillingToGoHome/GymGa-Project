<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Title</title>
    <link rel="stylesheet" href="../styles/mainStyle.css">
    <link rel="stylesheet" href="../styles/headerStyle.css">
    <link rel="stylesheet" href="../styles/navbarStyle.css">
    <link rel="stylesheet" href="../styles/myStyle.css">
    <link rel="stylesheet" href="../styles/footerStyle.css">
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap">

    <style>
        .dropdown {
            position: relative;
            display: inline-block;
        }

        .dropdown-content {
            display: none;
            position: absolute;
            background-color: #f9f9f9;
            min-width: 160px;
            box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
            z-index: 1;
        }

        .dropdown-content a {
            color: black;
            padding: 12px 16px;
            text-decoration: none;
            display: block;
        }

        .dropdown-content a:hover {
            background-color: #f1f1f1;
        }

        .dropdown:hover .dropdown-content {
            display: block;
        }

        .dropdown {
            float: right;
            margin-right: 100px;
        }

        .container {
            display: grid;
            grid-template-columns: repeat(8, 1fr); /* 8 columns with equal width */
            width: 1440px;
            min-height: 610px;
        }

        .fac-item {
            width: 100px; /* Adjust as needed */
            height: 100px; /* Adjust as needed */
            background-color: #8DD0F6;
            border-radius: 20px;
            list-style: none;
            display: flex;
            flex-direction: column;
            cursor: pointer;

        }

        .facCodeLink {
            font-size: 18px;
            margin-left: 10px;
            color: black;

        }

        .facStatus {
            font-size: 14px;
            position: relative;
            top: -20px;
            right: -50px;
            color: black;
        }

        .userCode,
        .facStart,
        .facEnd {
            font-size: 12px;
            font-weight: bold;
            text-align: center;
            text-indent: -10px;
            margin-bottom: 10px;
            margin-top: -10px;
            color: black;

        }

        .modal-title {
            color: black;
        }

        label{
            color: black;
        }
    </style>
</head>
<body>



<div class="container">
    <div class="app-area">
        <!--Heade Start-->
        <div th:include="common/header"></div>
        <!--Header End-->

        <!--Main Start-->
        <div class="main-container">
            <!--Navbar Start-->
            <div th:include="common/navbar"></div>
            <!--Navbar End-->
            <!--개인 작업 시작-->
            <div class="my-style">

                <div class="container">
                    <div th:each="facs: ${facList}" class="fac-item" href="#" data-toggle="modal" data-target="#facActionModal">
                        <!-- Locker Code -->
                        <span th:text="${facs.facCode}" class="facCodeLink"></span>
                        <!-- Locker Status -->
                        <span class="facStatus" th:text="${facs.facStatus}"></span>
                        <!-- User Code -->
                        <span class="userCode" th:text="${facs.userCode}"></span>
                        <!-- Start Date -->
                        <span class="facStart" th:text="${facs.facStart}"></span>
                        <!-- End Date -->
                        <span class="facEnd" th:text="${facs.facEnd}"></span>
                    </div>
                </div>

<div class="dropdown">
    <button class="dropbtn">조회</button>
    <div class="dropdown-content">
        <button type="button" class="btn btn-secondary" data-toggle="modal" data-target="#personalModal">개인조회</button>
        <a href="/fac/select/expired">만료조회</a>
    </div>
</div>

<!-- 개인 조회 모달 -->
<div class="modal fade" id="personalModal" tabindex="-1" role="dialog" aria-labelledby="personalModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="personalModalLabel">개인 조회</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <label>사물함 번호: </label>
                <select name="facCode" id="facCode"></select><br>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">닫기</button>
                <button onclick="sendRequest()" class="btn btn-primary" data-dismiss="modal">확인</button>
            </div>
        </div>
    </div>
</div>

<script>
    function sendRequest() {
        // 선택된 회원 코드 가져오기
        const selectedFacCode = document.getElementById("facCode").value;
        // userCode 파라미터를 포함하여 URL로 이동
        window.location.href = "/fac/select/personal?facCode=" + selectedFacCode;
    }
</script>

<script>
    fetch("/fac/fac")
        .then(res=>res.json())
        .then(data=> {
            const $facCode=document.getElementById("facCode");

            for(let index in data) {
                const $option=document.createElement('option');
                $option.text=data[index].facCode;
                $option.value=data[index].facCode;
                $facCode.appendChild($option);
            }
        })
</script>




<!-- 사물함 등록, 수정, 삭제 모달 -->
<div class="modal fade" id="facActionModal" tabindex="-1" role="dialog" aria-labelledby="facActionModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="facActionModalLabel">사물함 등록, 수정 및 삭제</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <!-- 등록, 수정, 삭제 버튼 -->
                <button type="button" class="btn btn-secondary" data-toggle="modal" data-target="#facActionModal2">등록</button>
                <button type="button" class="btn btn-secondary" data-toggle="modal" data-target="#facActionModal3">수정</button>
                <button type="button" class="btn btn-secondary" data-toggle="modal" data-target="#facActionModal4">삭제</button>


                <!--                <a class="btn btn-secondary" href="/fac/update">수정</a>-->
                <!--                <a class="btn btn-secondary" href="/fac/delete">삭제</a>-->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">닫기</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="facActionModal2" tabindex="-1" role="dialog" aria-labelledby="facActionModalLabel2" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="facActionModalLabel2" >사물함 등록</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="registForm" onsubmit="submitForm()">
                    <label>사물함 번호: </label>
                    <input type="text" name="facCode" id="clickedFacCodeInput" readonly><br>
                    <label>회원 코드: </label>
                    <select name="userCode" id="userCode"></select><br>
                    <label>사용 가능 상태: </label>
                    <select name="facStatus" id="facStatus">
                        <option value=""></option>
                        <option value="사용중">사용 중</option>
                        <option value="만료">만료</option>
                    </select><br>
                    <label>사용 시작 기간: </label>
                    <input type="date" name="facStart" id="facStart"><br>
                    <label>사용 만료 기간: </label>
                    <input type="date" name="facEnd" id="facEnd"><br>

                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">닫기</button>
                <button onclick="submitForm()" class="btn btn-primary" data-dismiss="modal">확인</button>
            </div>
        </div>
    </div>
</div>

<script>
    function submitForm() {

// 폼 데이터 가져오기
        const formData = new FormData(document.getElementById("registForm"))


// POST 요청 보내기
        fetch("/fac/regist", {
            method: "POST",
            body: formData
        })
            .then(response => {
                if (response.ok) {
// 성공적으로 처리된 경우 모달 닫기
                    $('#facActionModal').modal('hide');
                    window.location.href = "/fac/select";


                } else {
// 실패한 경우 오류 메시지 표시
                    console.error('등록 실패');
                }
            })
            .catch(error => console.error('에러 발생:', error));
    }
</script>



<script th:inline="javascript">
    $(document).ready(function () {
        // 클릭한 번호를 input 상자에 보여주는 함수
        $('.fac-item').click(function() {
            // 클릭한 번호 가져오기
            var facCode = $(this).text(); // 링크의 텍스트를 가져옴
            var $div = $(this).closest('div');
            var userCode = $div.find('.userCode').text();

            // data-faccode 속성에 번호 설정
            $('#facActionModal').attr('data-facCode', facCode);
            // input 상자에 번호 표시
            $('#clickedFacCodeInput').val(facCode);
            $('#clickedFacCodeInput2').val(facCode);
            $('#clickedFacCodeInput3').val(facCode);
            $('#clickedUserCodeInput').val(userCode);
        });
    });
</script>

<script>
    fetch("/fac/user")
        .then(res=>res.json())
        .then(data=> {
            const $userCode=document.getElementById("userCode");

            for(let index in data) {
                const $option=document.createElement('option');
                $option.text=data[index].userCode;
                $userCode.appendChild($option);
            }
        })
</script>





<div class="modal fade" id="facActionModal3" tabindex="-1" role="dialog" aria-labelledby="facActionModalLabel3" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="facActionModalLabel3">사물함 수정</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="updateForm" onsubmit="submitForm2()">
                    <label>사물함 번호: </label>
                    <input type="text" name="facCode" id="clickedFacCodeInput2"><br>
                    <label>회원 코드: </label>
                    <input type="text" name="userCode" id="clickedUserCodeInput" ><br>
                    <!--                    <label>회원 코드: </label>-->
                    <!--                    <select name="userCode" id="userCode3"></select><br>-->
                    <label>사용 가능 상태: </label>
                    <select name="facStatus" id="facStatus3">
                        <option value=""></option>
                        <option value="사용중">사용 중</option>
                        <option value="만료">만료</option>
                    </select><br>
                    <label>사용 시작 기간: </label><input type="date" name="facStart"><br>
                    <label>사용 만료 기간: </label><input type="date" name="facEnd"><br>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">닫기</button>
                <button onclick="submitForm2()" class="btn btn-primary" data-dismiss="modal">확인</button>
            </div>
        </div>
    </div>
</div>
<script>
    function submitForm2() {

// 폼 데이터 가져오기
        const formData = new FormData(document.getElementById("updateForm"));

// POST 요청 보내기
        fetch("/fac/update", {
            method: "POST",
            body: formData
        })
            .then(response => {
                if (response.ok) {
// 성공적으로 처리된 경우 모달 닫기
                    $('#updateModal').modal('hide');
                    $('#facActionModal').modal('hide');
                    window.location.href = "/fac/select";

                } else {
// 실패한 경우 오류 메시지 표시
                    console.error('등록 실패');
                }
            })
            .catch(error => console.error('에러 발생:', error));
    }

</script>


<script>
    fetch("/fac/user")
        .then(res=>res.json())
        .then(data=> {
            const $userCode=document.getElementById("userCode3");

            for(let index in data) {
                const $option=document.createElement('option');
                $option.text=data[index].userCode;
                $userCode.appendChild($option);
            }
        })
</script>

<script>
    fetch("/fac/fac")
        .then(res=>res.json())
        .then(data=> {
            const $facCode=document.getElementById("facActionModalFacCode3");

            for(let index in data) {
                const $option=document.createElement('option');
                $option.text=data[index].facCode;
                $option.value=data[index].facCode;
                $facCode.appendChild($option);
            }
        })
</script>


<div class="modal fade" id="facActionModal4" tabindex="-1" role="dialog" aria-labelledby="facActionModalLabel4" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="facActionModalLabel4">사물함 삭제</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="deleteForm" onsubmit="submitForm3()">
                    <label>사물함 번호: </label>
                    <input type="text" name="facCode" id="clickedFacCodeInput3" readonly><br>
                    <label>사용 가능 상태: </label>
                    <select name="facStatus" id="facStatus4">
                        <option value=""></option>
                        <option value="사용중">사용 중</option>
                        <option value="만료">만료</option>
                    </select><br>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">닫기</button>
                <button onclick="submitForm3()" class="btn btn-primary" data-dismiss="modal">확인</button>
            </div>
        </div>
    </div>
</div>



<script>
    function submitForm3() {

// 폼 데이터 가져오기
        const formData = new FormData(document.getElementById("deleteForm"));

// POST 요청 보내기
        fetch("/fac/delete", {
            method: "POST",
            body: formData
        })
            .then(response => {
                if (response.ok) {
// 성공적으로 처리된 경우 모달 닫기
                    $('#facActionModal').modal('hide');
                    window.location.href = "/fac/select";

                } else {
// 실패한 경우 오류 메시지 표시
                    console.error('등록 실패');
                }
            })
            .catch(error => console.error('에러 발생:', error));
    }

</script>



<script>
    fetch("/fac/user")
        .then(res=>res.json())
        .then(data=> {
            const $userCode=document.getElementById("userCode4");

            for(let index in data) {
                const $option=document.createElement('option');
                $option.text=data[index].userCode;
                $userCode.appendChild($option);
            }
        })
</script>

<script>
    fetch("/fac/fac")
        .then(res=>res.json())
        .then(data=> {
            const $facCode=document.getElementById("facActionModalFacCode4");

            for(let index in data) {
                const $option=document.createElement('option');
                $option.text=data[index].facCode;
                $option.value=data[index].facCode;
                $facCode.appendChild($option);
            }
        })


</script>
            </div>
            <!--개인 작업 종료-->
        </div>
        <!--Main End-->

        <!--Footer Start-->
        <div th:include="common/footer"></div>
        <!--Footer End-->
    </div>
</div>


<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

</body>
</html>