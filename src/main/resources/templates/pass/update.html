<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>이용권 변경 및 환불</title>
    <link rel="stylesheet" href="/styles/mainStyle.css">
    <link rel="stylesheet" href="/styles/headerStyle.css">
    <link rel="stylesheet" href="/styles/navbarStyle.css">
    <link rel="stylesheet" href="/styles/myStyle.css">
    <link rel="stylesheet" href="/styles/passUpdateStyle.css">
    <link rel="stylesheet" href="/styles/footerStyle.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap">
</head>
<body>
<div class="container">
    <div class="app-area">
        <!--Heade Start-->
        <div th:include="common/header"></div>
        <!--Header End-->

        <!--Main Start-->
        <div class="main-container">
            <!--Navbar Start-->
            <div th:include="common/navbar"></div>
            <!--Navbar End-->
            <!--개인 작업 시작-->
            <div class="my-style">
                <div class="contents">
                    <div class="on">
                        <img src="/img/Back.png" onClick="location.href='/pass/main'" class="back">
                        <p class="text">이용권 변경 및 환불</p>
                        <form action="/pass/update" method="post" class="top">
                            <input type="text" class="search" name="search" placeholder="검색 내용">
                            <select name="category" class="option">
                                <option value="basic">카테고리</option>
                                <option value="name">이름</option>
                                <option value="id">아이디</option>
                            </select>
                            <button type="submit" class="searchButton">검색</button>
                        </form>
                    </div>
                    <hr class="hr1">
                    <div class="title">
                        <p class="titleText">이름</p>
                        <p class="titleText">아이디</p>
                        <p class="titleText">이용권</p>
                        <p class="titleText">이용권 상태</p>
                        <p class="titleText">결제 금액</p>
                        <p class="titleText">담당 강사</p>
                        <p class="titleText" style="padding-right: 29px">변경/환불</p>
                    </div>
                    <hr class="hr2">
                    <div class="passUpdate">
                        <div class="userList" th:each="pass:${passList}"
                            th:data-user-code="${pass.userDTO.userCode}"
                            th:data-user-name="${pass.userDTO.userName}"
                            th:data-pass-status="${pass.passStatus}"
                            th:data-pass-pq-name="${pass.passQualDTO.pqName}">
                            <p class="userName" th:text="${pass.userDTO.userName}"></p>
                            <p class="userId" th:text="${pass.userDTO.userId}"></p>
                            <p class="userPass" th:text="${pass.passQualDTO.pqName}"></p>
                            <p class="userPassStatus" th:text="${pass.passStatus}"></p>
                            <p class="userPassPrice" th:text="${pass.passQualDTO.pqPrice}"></p>
                            <p class="userStaff" th:if="${pass.userDTO.userStaff == 0 || pass.userDTO.userStaff == null}" th:text="없음"></p>
                            <p class="userStaff" th:if="${pass.userDTO.userStaff}">
                                <span th:text="${pass.userDTO.staffName}"></span>
                            </p>
                            <div class="buttonBox">
                                    <input type="hidden" name="code" th:value="${pass.userDTO.userCode}">
                                    <input class="changeButton" type="submit" value="변경">
                                <button class="refundButton">환불</button>
                                <div class="modalContainer">
                                    <div class="modalContent">
                                        <div class="textBox" th:object="${pass}">
                                            <form action="/pass/change" method="post">
                                                <h3>이용권 변경</h3>
                                                    <label class="modalText">
                                                        회원명
                                                        <input type="text" id="userName" name="userName" th:placeholeder="${pass.userDTO.userName}" readonly>
                                                    </label>
                                            </form>
                                        </div>
                                        <div class="modalButtonBox">
                                            <button class="cancelButton">취소</button>
                                            <form action="/pass/change" method="post">
                                                <input type="hidden" name="code" th:value="${pass.userDTO.userCode}">
                                                <input class="changeButton2" type="submit" value="변경">
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!--개인 작업 종료-->
        </div>
        <!--Main End-->

        <!--Footer Start-->
        <div th:include="common/footer"></div>
        <!--Footer End-->
    </div>
</div>


<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function() {
        var userListSize = $(".userList").length;
        for (var i = 0; i < userListSize - 1; i++) {
            var userList = $(".userList:eq(" + i + ")");
            userList.after("<div>");
            var hrDiv = userList.next();
            hrDiv.append("<div><hr class='hr3'></div>");
        }

        $(".changeButton").click(function() {;
            var userList = $(this).closest(".userList");
            var userName = userList.data("user-name");
            var userCode = userList.data("user-code");

            var modal = userList.find(".modalContainer");
            modal.find(".modalUserName").val(userName);
            modal.find(".modalUserCode").val(userCode);

            modal.show();
        });

        $(".cancelButton").click(function() {
            $(this).closest(".modalContainer").hide();
        });
    });
</script>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        var prices = document.querySelectorAll('.userPassPrice');
        prices.forEach(function(price) {
            var value = price.textContent.trim();
            var formattedValue = Number(value).toLocaleString('en');
            price.textContent = formattedValue + '원';
        });
    });
</script>
</body>
</html>